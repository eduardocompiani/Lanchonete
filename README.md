# CODIGO MYSQL PARA CRIACAO DO BANCO

```CRIACAO DO BANCO DE DADOS
CREATE DATABASE LANCHONETEDB;
USE LANCHONETEDB;
CREATE TABLE PRODUTO(
	CDPRODUTO INT PRIMARY KEY AUTO_INCREMENT,
    NMPRODUTO VARCHAR(255) NOT NULL,
    VLPRODUTO FLOAT NOT NULL
);
CREATE TABLE COMBO(
	CDCOMBO INT PRIMARY KEY AUTO_INCREMENT,
    NMCOMBO VARCHAR(255) NOT NULL,
    VLDESCONTO FLOAT NOT NULL
);
CREATE TABLE PRODUTO_DO_COMBO(
	CDCOMBO INT,
    CDPRODUTO INT,
    CONSTRAINT FK_COMBO FOREIGN KEY (CDCOMBO) REFERENCES COMBO(CDCOMBO),
    CONSTRAINT FK_PRODUTO FOREIGN KEY (CDPRODUTO) REFERENCES PRODUTO(CDPRODUTO)
);
CREATE TABLE PEDIDO(
	CDPEDIDO INT PRIMARY KEY AUTO_INCREMENT,
    VLTOTAL FLOAT
);
CREATE TABLE PEDIDO_ITEM(
    CDPEDIDO INT,
    CDCOMBO INT NULL,
    CDPRODUTO INT NULL,
    QTDPEDIDO INT NOT NULL,
    CONSTRAINT FK_PEDIDO_ITEM FOREIGN KEY (CDPEDIDO) REFERENCES PEDIDO(CDPEDIDO),
    CONSTRAINT FK_PRODUTO_ITEM FOREIGN KEY (CDPRODUTO) REFERENCES PRODUTO(CDPRODUTO),
    CONSTRAINT FK_COMBO_ITEM FOREIGN KEY (CDCOMBO) REFERENCES COMBO(CDCOMBO)
);
```

```POPULANDO BANCO DE DADOS
USE LANCHONETEDB;

#CRIO OS PRODUTOS
INSERT INTO PRODUTO(NMPRODUTO, VLPRODUTO) VALUES ('BATATA', 4.00);
INSERT INTO PRODUTO(NMPRODUTO, VLPRODUTO) VALUES ('REFRIGERANTE', 6.00);
INSERT INTO PRODUTO(NMPRODUTO, VLPRODUTO) VALUES ('HAMBURGUER', 10.00);

#CRIO O COMBO
INSERT INTO COMBO(NMCOMBO, VLDESCONTO) VALUES ('PIKA', 5);

# ASSOCIO OS PRODUTOS A UM COMBO
INSERT INTO PRODUTO_DO_COMBO(CDCOMBO, CDPRODUTO) VALUES(1,1);
INSERT INTO PRODUTO_DO_COMBO(CDCOMBO, CDPRODUTO) VALUES(1,2);
INSERT INTO PRODUTO_DO_COMBO(CDCOMBO, CDPRODUTO) VALUES(1,3);

#CRIO UM PEDIDO
INSERT INTO PEDIDO(VLTOTAL) VALUES (NULL);

#EXECUTO O PEDIDO DE UM ITEM
INSERT INTO PEDIDO_ITEM(CDPEDIDO,CDCOMBO, CDPRODUTO, QTDPEDIDO) VALUES(1,1,NULL,1);
INSERT INTO PEDIDO_ITEM(CDPEDIDO,CDCOMBO, CDPRODUTO, QTDPEDIDO) VALUES(1,NULL,1,1);
```

``` SQL PARA MONTAGEM DA NOTA FISCAL
USE LANCHONETEDB;

SELECT 
	PRODUTO_COM_DESCONTO.NMPRODUTO,
	((PRODUTO_COM_DESCONTO.VLPRODUTO -(PRODUTO_COM_DESCONTO.VLPRODUTO * (COMBO.VLDESCONTO / 100))) * PEDIDO_ITEM.QTDPEDIDO) AS VLPRODUTO,
    PEDIDO_ITEM.QTDPEDIDO
FROM 
	PEDIDO
    INNER JOIN PEDIDO_ITEM ON (PEDIDO.CDPEDIDO = PEDIDO_ITEM.CDPEDIDO)
    INNER JOIN COMBO ON (COMBO.CDCOMBO = PEDIDO_ITEM.CDCOMBO)
    INNER JOIN PRODUTO_DO_COMBO ON (COMBO.CDCOMBO = PRODUTO_DO_COMBO.CDCOMBO)
    INNER JOIN PRODUTO PRODUTO_COM_DESCONTO ON (PRODUTO_DO_COMBO.CDPRODUTO = PRODUTO_COM_DESCONTO.CDPRODUTO)
WHERE
	PEDIDO.CDPEDIDO = 1
UNION
SELECT
	PRODUTO.NMPRODUTO,
    (PRODUTO.VLPRODUTO * PEDIDO_ITEM.QTDPEDIDO),
    PEDIDO_ITEM.QTDPEDIDO
FROM
	PEDIDO
    INNER JOIN PEDIDO_ITEM ON (PEDIDO_ITEM.CDPEDIDO = PEDIDO.CDPEDIDO)
    INNER JOIN PRODUTO ON (PRODUTO.CDPRODUTO = PEDIDO_ITEM.CDPRODUTO)
WHERE 
	PEDIDO.CDPEDIDO = 1
```
